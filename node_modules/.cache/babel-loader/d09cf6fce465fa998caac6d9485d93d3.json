{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n            Text {\\n                @props prop\\n                text = text\\n                behavior:tooltip {\\n                    content = \\\"double click to edit content\\\"\\n                }\\n        }\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport { Component } from \"crux/dist/element\";\nimport { event } from \"crux/dist/utils\";\nexport var EditText = /*#__PURE__*/function (_Component) {\n  _inherits(EditText, _Component);\n\n  var _super = _createSuper(EditText);\n\n  function EditText() {\n    var _this;\n\n    _classCallCheck(this, EditText);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.originalText = \"\";\n    _this.text = \"\";\n    return _this;\n  }\n\n  _createClass(EditText, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n\n      this.state = {\n        activeBand: null\n      };\n      event.on(\"edit-text-done\", function (_, _ref) {\n        var text = _ref.text,\n            id = _ref.id;\n\n        if (_this2.uid === id) {\n          // this.setProp({text});\n          _this2.text = text;\n\n          _this2.redraw();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return this.t(_templateObject());\n    }\n  }, {\n    key: \"willRender\",\n    value: function willRender() {\n      var _this3 = this;\n\n      if (this._firstRender) {\n        this.originalText = this.prop.text;\n        this.setDisplayText();\n\n        this.$on[\"dblclick\"] = function () {\n          event.emit(\"edit-text-start\", {\n            text: _this3.prop.text,\n            originalText: _this3.originalText,\n            id: _this3.uid\n          });\n        };\n      } else if (this.prop.text !== this.originalText) {\n        this.text = this.originalText = this.prop.text;\n      }\n    }\n  }, {\n    key: \"setDisplayText\",\n    value: function setDisplayText() {\n      if (this.prop.text.length <= this.prop.displayTextLength) this.text = this.prop.text;else if (this.prop.text.indexOf(\"_\") >= 0) {\n        var strs = this.prop.text.split(\"_\");\n        var length = 0,\n            i = 1,\n            text = strs[0];\n\n        while (strs[i] && length + strs[i] <= this.prop.displayTextLength) {\n          text = \"\".concat(text, \"_\").concat(strs[i]);\n          length += strs[i].length;\n          i++;\n        }\n\n        this.text = \"\".concat(text, \"...\");\n      } else {\n        this.text = \"\".concat(this.prop.text.substr(0, this.prop.displayTextLength), \"...\");\n      }\n    }\n  }, {\n    key: \"defaultProp\",\n    value: function defaultProp() {\n      return _objectSpread(_objectSpread({}, _get(_getPrototypeOf(EditText.prototype), \"defaultProp\", this).call(this)), {}, {\n        displayTextLength: 40\n      });\n    }\n  }], [{\n    key: \"propNameForInitializer\",\n    value: function propNameForInitializer() {\n      return \"text\";\n    }\n  }]);\n\n  return EditText;\n}(Component);","map":{"version":3,"sources":["/Users/wangzhenyu/Desktop/fyp_workspace/meta_platform/app/javascript/oviz-components/edit-text.ts"],"names":["Component","event","EditText","originalText","text","state","activeBand","on","_","id","uid","redraw","t","_firstRender","prop","setDisplayText","$on","emit","length","displayTextLength","indexOf","strs","split","i","substr"],"mappings":"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","sourcesContent":["import { Component, ComponentOption } from \"crux/dist/element\";\nimport {TextOption} from \"crux/dist/element/primitive/text\";\nimport { event } from \"crux/dist/utils\";\n\ninterface EditTextOption extends ComponentOption {\n    displayTextLength: number;\n}\nexport class EditText extends Component<TextOption & EditTextOption> {\n    protected originalText = \"\";\n    protected text = \"\";\n\n    public init() {\n        this.state = {\n            activeBand: null,\n        };\n        event.on(\"edit-text-done\", (_, { text, id }) => {\n            if (this.uid === id) {\n                // this.setProp({text});\n                this.text = text;\n                this.redraw();\n            }\n        });\n    }\n\n    public render() {\n        return this.t`\n            Text {\n                @props prop\n                text = text\n                behavior:tooltip {\n                    content = \"double click to edit content\"\n                }\n        }`;\n    }\n    public static propNameForInitializer() {\n        return \"text\";\n    }\n    public willRender() {\n        if (this._firstRender) {\n            this.originalText = this.prop.text;\n            this.setDisplayText();\n            this.$on[\"dblclick\"] = () => {\n                event.emit(\"edit-text-start\", {text: this.prop.text,\n                    originalText: this.originalText,\n                    id: this.uid});\n            };\n        } else if (this.prop.text !== this.originalText) {\n            this.text = this.originalText = this.prop.text;\n        }\n    }\n\n    protected setDisplayText() {\n        if (this.prop.text.length <= this.prop.displayTextLength)\n            this.text = this.prop.text;\n        else if (this.prop.text.indexOf(\"_\") >= 0) {\n            const strs = this.prop.text.split(\"_\");\n            let length = 0,\n                i = 1,\n                text = strs[0];\n            while (strs[i] && length + strs[i] <= this.prop.displayTextLength) {\n                text = `${text}_${strs[i]}`;\n                length += strs[i].length;\n                i++;\n            }\n            this.text = `${text}...`;\n        } else {\n            this.text = `${this.prop.text.substr(0, this.prop.displayTextLength)}...`;\n        }\n\n    }\n\n    public defaultProp() {\n        return {\n            ...super.defaultProp(),\n            displayTextLength: 40,\n        };\n    }\n}\n"]},"metadata":{},"sourceType":"module"}