{"ast":null,"code":"import axios from \"axios\";\nimport { schemeGradient } from \"crux/dist/color\";\nimport { max } from \"crux/dist/utils/math\";\nimport * as d3 from \"d3\";\nimport { feature } from \"topojson\";\nvar width = 1060,\n    height = 500,\n    paddingB = 100,\n    colors = {\n  background: \"white\",\n  activeStroke: \"orange\",\n  iconStroke: \"darkslateblue\",\n  rangeMin: \"rgb(200,210,230)\",\n  rangeMax: \"#3262a8\"\n};\nvar scaleFactor = 1;\nvar scaleBarPos = d3.scaleLinear().range([0, 80]).domain([1, 5]);\nvar svg = d3.select(\"#world-map\").append(\"svg:svg\").attr(\"width\", width).attr(\"height\", height + paddingB); // Define the div for the tooltip\n\nvar div = d3.select(\"#world-map\").append(\"div\").attr(\"class\", \"tooltip\").style(\"events\", \"none\").style(\"opacity\", 0);\nsvg.append(\"g\").attr(\"id\", \"container\");\nvar projection = d3.geoNaturalEarth1(); // const projection = d3.geoCylindricalStereographic();\n\nvar pathGenerator = d3.geoPath().projection(projection);\nvar g = d3.select(\"#container\").append(\"g\").attr(\"id\", \"zoom-area\");\nvar otherG = d3.select(\"#container\").append(\"g\").attr(\"id\", \"other\").attr(\"transform\", \"translate(50, \".concat(height - 50, \")\"));\nvar legendG = d3.select(\"#container\").append(\"g\").attr(\"id\", \"legend\").attr(\"transform\", \"translate(0, \".concat(height, \")\"));\nvar zoomBarG = d3.select(\"#container\").append(\"g\").attr(\"id\", \"zoomBar\").attr(\"transform\", \"translate(\".concat(width - 100, \", \").concat(height - 50, \")\")); // draw zoom indication bar\n\nzoomBarG.append(\"polygon\").attr(\"id\", \"scaleAnchor\").attr(\"points\", \"0,0 10,0 5,10\").attr(\"transform\", \"translate(0,10)\").attr(\"fill\", \"#666\");\nvar scaleTicks = [1, 2, 3, 4, 5];\nzoomBarG.selectAll(\"line\").data(scaleTicks).enter().append(\"line\").attr(\"stroke\", \"#000\").attr(\"y1\", 20).attr(\"y2\", 15).attr(\"x1\", function (d) {\n  return scaleBarPos(d) + 5;\n}).attr(\"x2\", function (d) {\n  return scaleBarPos(d) + 5;\n});\nzoomBarG.selectAll(\"text\").data(scaleTicks).enter().append(\"text\").attr(\"font-size\", \"11\").attr(\"y\", 32).attr(\"text-anchor\", \"middle\").text(function (d) {\n  return d;\n}).attr(\"x\", function (d) {\n  return scaleBarPos(d) + 5;\n});\nzoomBarG.append(\"text\").attr(\"class\", \"fa help-text\").attr(\"font-family\", \"arial\").text(\"\\uF059\").attr(\"font-size\", \"12\").attr(\"x\", 0).attr(\"y\", 0).style(\"fill\", \"#666\");\nzoomBarG.append(\"text\").attr(\"class\", \"help-text\").text(\"Zoom Scale: \").attr(\"font-size\", 11).attr(\"x\", 13).attr(\"y\", 0);\nzoomBarG.selectAll(\"text.help-text\").attr(\"cursor\", \"help\").on(\"mouseover\", function () {\n  div.transition().duration(200).style(\"opacity\", 1);\n  div.html(\"<strong>Wheel to zoom in/out</strong><br>\\n                <strong>Click on blank space to reset</strong>\").style(\"left\", d3.event.pageX + 15 + \"px\").style(\"top\", d3.event.pageY + 15 + \"px\").style(\"padding\", \"5px\").style(\"border-radius\", \"3px\").style(\"color\", \"white\").style(\"background-color\", \"rgba(50,50,50, 0.85)\");\n}).on(\"mouseout\", function () {\n  div.transition().duration(500).style(\"opacity\", 0);\n});\nzoomBarG.append(\"line\").attr(\"strokeWidth\", 1).attr(\"stroke\", \"#000\").attr(\"x1\", 5).attr(\"y1\", 20).attr(\"x2\", 85).attr(\"y2\", 20); // gradient and legend\n\nvar gradientDef = svg.append(\"defs\").append(\"svg:linearGradient\").attr(\"id\", \"gradient\").attr(\"x1\", \"0%\").attr(\"y1\", \"100%\").attr(\"x2\", \"100%\").attr(\"y2\", \"100%\").attr(\"spreadMethod\", \"pad\");\ngradientDef.append(\"stop\").attr(\"offset\", \"0%\").attr(\"stop-color\", colors.rangeMin).attr(\"stop-opacity\", 1);\ngradientDef.append(\"stop\").attr(\"offset\", \"100%\").attr(\"stop-color\", colors.rangeMax).attr(\"stop-opacity\", 1);\nvar grad = schemeGradient(colors.rangeMin, colors.rangeMax);\n\nvar reset = function reset() {\n  g.transition().duration(50).call(zoom.transform, d3.zoomIdentity);\n};\n\nd3.select(\"#container\").append(\"rect\").attr(\"width\", width).attr(\"height\", height).attr(\"stroke\", \"grey\").attr(\"strokeWidth\", 2).attr(\"fill\", \"none\");\ng.append(\"path\").attr(\"class\", \"sphere\").attr(\"d\", pathGenerator({\n  type: \"Sphere\"\n})).attr(\"fill\", colors.background).on(\"click\", reset);\naxios.all([axios.get(\"/data/static_viz_data/world_map/countries-110m.json\"), // topo info\naxios.get(\"/data/static_viz_data/world_map/country.tsv\"), // database data\naxios.get(\"/data/static_viz_data/world_map/small-countries.txt\") // extreme small countries\n]).then(axios.spread(function (topo, stat, small) {\n  // process data\n  var temp = feature(topo.data, topo.data.objects.countries).features;\n  var countries = Object.keys(temp).map(function (k) {\n    return temp[k];\n  });\n  var data = d3.tsvParse(stat.data);\n  var validCountries = data.map(function (x) {\n    return x.country;\n  });\n  var smallCountries = small.data.split(/\\r?\\n/).filter(function (e) {\n    return validCountries.indexOf(e) >= 0;\n  }).map(function (k) {\n    return countries.find(function (x) {\n      return x.properties.name === k;\n    });\n  });\n  var dict = {};\n  var numbers = [];\n  data.forEach(function (x) {\n    dict[x.country] = parseInt(x.number);\n    numbers.push(parseInt(x.number));\n  }); // visualization functions\n\n  var maxValue = max(numbers);\n  var myScale = d3.scaleLinear().domain([0, maxValue]).range([0, 1]);\n\n  var getCountryFill = function getCountryFill(d) {\n    var name = d.properties.name;\n    if (dict[name]) return grad.get(myScale(dict[name]));else return \"lightgrey\";\n  };\n\n  var showTooltip = function showTooltip(d) {\n    div.transition().duration(200).style(\"opacity\", 1);\n    div.html(\"<strong>Country: </strong><span class=\\\"details\\\">\".concat(d.properties.name, \"\\n                <br></span><strong>Sample number: </strong><span class=\\\"details\\\">\").concat(dict[d.properties.name] || \"N/A\", \"</span>\")).style(\"left\", d3.event.pageX + 15 + \"px\").style(\"top\", d3.event.pageY + 15 + \"px\").style(\"padding\", \"5px\").style(\"border-radius\", \"3px\").style(\"color\", \"white\").style(\"background-color\", \"rgba(50,50,50, 0.85)\");\n  };\n\n  var moveTooltip = function moveTooltip() {\n    div.style(\"left\", d3.event.pageX + 15 + \"px\").style(\"top\", d3.event.pageY + 15 + \"px\");\n  };\n\n  var hideTooltip = function hideTooltip() {\n    div.transition().duration(500).style(\"opacity\", 0);\n  };\n\n  var highlightCountry = function highlightCountry(sel) {\n    d3.select(sel).style(\"opacity\", 1).style(\"stroke\", colors.activeStroke).style(\"stroke-width\", 2 / scaleFactor).raise();\n    d3.selectAll(\"text.fa\").raise();\n    g.transition().duration(100);\n  };\n\n  var resetHighlight = function resetHighlight(sel) {\n    d3.select(sel).transition().duration(100).style(\"opacity\", 0.9).style(\"stroke\", colors.background).style(\"stroke-width\", 1 / scaleFactor);\n  }; // draw legend\n\n\n  legendG.append(\"rect\").attr(\"fill\", \"white\").attr(\"width\", width).attr(\"height\", paddingB);\n  legendG.append(\"rect\").style(\"fill\", \"url(#gradient)\").attr(\"x\", 250).attr(\"y\", paddingB / 4).attr(\"width\", width - 500).attr(\"height\", paddingB / 5);\n  legendG.append(\"text\").text(\"0\").attr(\"text-anchor\", \"end\").attr(\"x\", 248).attr(\"y\", paddingB * 0.45 - 5);\n  legendG.append(\"text\").text(maxValue).attr(\"text-anchor\", \"start\").attr(\"x\", width - 248).attr(\"y\", paddingB * 0.45 - 5); // draw country path\n\n  g.selectAll(\"path.country\").data(countries).enter().append(\"path\").attr(\"id\", function (d) {\n    return d.properties.name;\n  }).attr(\"class\", \"country\").attr(\"d\", pathGenerator).attr(\"fill\", getCountryFill).attr(\"opacity\", 0.9).attr(\"stroke\", colors.background).on(\"mouseover\", function (d) {\n    showTooltip(d);\n    highlightCountry(this);\n  }).on(\"mousemove\", moveTooltip).on(\"mouseout\", function () {\n    hideTooltip();\n    resetHighlight(this);\n  }); // draw map labels for extreme small countries\n\n  g.selectAll(\"text.label\").data(smallCountries).enter().append(\"text\").attr(\"class\", \"fa label\").attr(\"id\", function (d) {\n    var path = pathGenerator(d);\n    var coord = path.split(\"L\")[0].substring(1).split(\",\").map(function (x) {\n      return parseFloat(x);\n    });\n    d3.select(this).attr(\"x\", coord[0]).attr(\"y\", coord[1]);\n    return d.properties.name;\n  }).text(\"\\uF3C5\").attr(\"font-size\", \"18px\").attr(\"text-anchor\", \"middle\").attr(\"cursor\", \"default\").attr(\"fill\", getCountryFill).attr(\"stroke\", colors.iconStroke).on(\"mouseover\", function (d) {\n    showTooltip(d);\n    d3.select(this).style(\"stroke\", colors.activeStroke);\n    highlightCountry(\"path#\".concat(d.properties.name));\n  }).on(\"mousemove\", moveTooltip).on(\"mouseout\", function (d) {\n    hideTooltip();\n    d3.select(this).style(\"stroke\", colors.iconStroke);\n    resetHighlight(\"path#\".concat(d.properties.name));\n  }); // draw unknown cases\n\n  if (!!dict[\"NULL\"]) {\n    otherG.append(\"text\").text(\"Unknown: \".concat(dict[\"NULL\"])).attr(\"x\", 0).attr(\"y\", 20);\n  }\n})); // zoom interaction\n\nvar zoom = d3.zoom().extent([[0, 0], [width, height]]).scaleExtent([1, 5]).translateExtent([[0, 0], [width, height]]).on(\"zoom\", function () {\n  scaleFactor = d3.event.transform.k;\n  g.selectAll(\"text.fa\").attr(\"stroke-width\", \"\".concat(1 / scaleFactor, \"px\")).attr(\"font-size\", \"\".concat(20 / scaleFactor, \"px\")).attr(\"white-space\", function () {\n    if (scaleFactor > 4) {\n      console.log(scaleFactor);\n      d3.select(this).attr(\"opacity\", 0.3);\n    } else {\n      d3.select(this).attr(\"opacity\", 1);\n    }\n  });\n  g.selectAll(\"path.country\").attr(\"stroke-width\", \"\".concat(1 / scaleFactor, \"px\"));\n  g.attr(\"transform\", d3.event.transform);\n  var offsetX = scaleBarPos(d3.event.transform.k);\n  d3.select(\"#scaleAnchor\").transition().duration(100).attr(\"transform\", \"translate(\".concat(offsetX, \", 10)\"));\n});\nsvg.call(zoom);","map":{"version":3,"sources":["/Users/wangzhenyu/Desktop/fyp_workspace/meta_platform/app/javascript/viz/world-map.ts"],"names":["axios","schemeGradient","max","d3","feature","width","height","paddingB","colors","background","activeStroke","iconStroke","rangeMin","rangeMax","scaleFactor","scaleBarPos","scaleLinear","range","domain","svg","select","append","attr","div","style","projection","geoNaturalEarth1","pathGenerator","geoPath","g","otherG","legendG","zoomBarG","scaleTicks","selectAll","data","enter","d","text","on","transition","duration","html","event","pageX","pageY","gradientDef","grad","reset","call","zoom","transform","zoomIdentity","type","all","get","then","spread","topo","stat","small","temp","objects","countries","features","Object","keys","map","k","tsvParse","validCountries","x","country","smallCountries","split","filter","e","indexOf","find","properties","name","dict","numbers","forEach","parseInt","number","push","maxValue","myScale","getCountryFill","showTooltip","moveTooltip","hideTooltip","highlightCountry","sel","raise","resetHighlight","path","coord","substring","parseFloat","extent","scaleExtent","translateExtent","console","log","offsetX"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { schemeGradient } from \"crux/dist/color\";\nimport { max } from \"crux/dist/utils/math\";\nimport * as d3 from \"d3\";\nimport * as _ from \"lodash\";\nimport { feature } from \"topojson\";\n\n\nconst width = 1060,\n    height = 500,\n    paddingB = 100,\n    colors = {\n        background: \"white\",\n        activeStroke: \"orange\",\n        iconStroke: \"darkslateblue\",\n        rangeMin: \"rgb(200,210,230)\",\n        rangeMax: \"#3262a8\",\n    };\n\nlet scaleFactor = 1;\n\nconst scaleBarPos = d3.scaleLinear().range([0, 80])\n.domain([1, 5]);\n\nconst svg = d3.select(\"#world-map\")\n            .append(\"svg:svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height + paddingB);\n// Define the div for the tooltip\nconst div = d3.select(\"#world-map\").append(\"div\")\n            .attr(\"class\", \"tooltip\")\n            .style(\"events\", \"none\")\n            .style(\"opacity\", 0);\n\nsvg.append(\"g\").attr(\"id\", \"container\");\nconst projection = d3.geoNaturalEarth1();\n// const projection = d3.geoCylindricalStereographic();\n\nconst pathGenerator = d3.geoPath().projection(projection);\nconst g = d3.select(\"#container\").append(\"g\").attr(\"id\", \"zoom-area\");\nconst otherG = d3.select(\"#container\").append(\"g\").attr(\"id\", \"other\")\n    .attr(\"transform\", `translate(50, ${ height - 50})`);\nconst legendG = d3.select(\"#container\").append(\"g\").attr(\"id\", \"legend\")\n    .attr(\"transform\", `translate(0, ${ height})`);\nconst zoomBarG = d3.select(\"#container\").append(\"g\").attr(\"id\", \"zoomBar\")\n    .attr(\"transform\", `translate(${width - 100}, ${ height - 50})`);\n\n// draw zoom indication bar\nzoomBarG.append(\"polygon\")\n        .attr(\"id\", \"scaleAnchor\")\n        .attr(\"points\", \"0,0 10,0 5,10\")\n        .attr(\"transform\", \"translate(0,10)\")\n        .attr(\"fill\", \"#666\");\nconst scaleTicks = [1, 2, 3, 4, 5];\nzoomBarG.selectAll(\"line\").data(scaleTicks)\n    .enter()\n    .append(\"line\")\n    .attr(\"stroke\", \"#000\")\n    .attr(\"y1\", 20)\n    .attr(\"y2\", 15)\n    .attr(\"x1\", (d) => scaleBarPos(d) + 5)\n    .attr(\"x2\", (d) => scaleBarPos(d) + 5);\nzoomBarG.selectAll(\"text\").data(scaleTicks)\n    .enter()\n    .append(\"text\")\n    .attr(\"font-size\", \"11\")\n    .attr(\"y\", 32)\n    .attr(\"text-anchor\", \"middle\")\n    .text((d) => d)\n    .attr(\"x\", (d) => scaleBarPos(d) + 5);\nzoomBarG.append(\"text\")\n        .attr(\"class\", \"fa help-text\")\n        .attr(\"font-family\", \"arial\")\n        .text(\"\\uf059\")\n        .attr(\"font-size\", \"12\").attr(\"x\", 0).attr(\"y\", 0)\n        .style(\"fill\", \"#666\");\nzoomBarG.append(\"text\")\n        .attr(\"class\", \"help-text\")\n        .text(\"Zoom Scale: \")\n        .attr(\"font-size\", 11).attr(\"x\", 13).attr(\"y\", 0);\nzoomBarG.selectAll(\"text.help-text\").attr(\"cursor\", \"help\")\n    .on(\"mouseover\", () => {\n        div.transition()\n            .duration(200)\n            .style(\"opacity\", 1);\n        div.html(`<strong>Wheel to zoom in/out</strong><br>\n                <strong>Click on blank space to reset</strong>`)\n            .style(\"left\", (d3.event.pageX + 15) + \"px\")\n            .style(\"top\", (d3.event.pageY + 15) + \"px\")\n            .style(\"padding\", \"5px\")\n            .style(\"border-radius\", \"3px\")\n            .style(\"color\", \"white\")\n            .style(\"background-color\", \"rgba(50,50,50, 0.85)\");\n  }).on(\"mouseout\", () => {\n    div.transition()\n        .duration(500)\n        .style(\"opacity\", 0);\n  });\nzoomBarG.append(\"line\").attr(\"strokeWidth\", 1)\n        .attr(\"stroke\", \"#000\").attr(\"x1\", 5).attr(\"y1\", 20)\n        .attr(\"x2\", 85).attr(\"y2\", 20);\n\n// gradient and legend\nconst gradientDef = svg.append(\"defs\")\n                .append(\"svg:linearGradient\")\n                .attr(\"id\", \"gradient\")\n                .attr(\"x1\", \"0%\")\n                .attr(\"y1\", \"100%\")\n                .attr(\"x2\", \"100%\")\n                .attr(\"y2\", \"100%\")\n                .attr(\"spreadMethod\", \"pad\");\ngradientDef.append(\"stop\")\n        .attr(\"offset\", \"0%\")\n        .attr(\"stop-color\", colors.rangeMin)\n        .attr(\"stop-opacity\", 1);\ngradientDef.append(\"stop\")\n        .attr(\"offset\", \"100%\")\n        .attr(\"stop-color\", colors.rangeMax)\n        .attr(\"stop-opacity\", 1);\n\nconst grad = schemeGradient(colors.rangeMin, colors.rangeMax);\n\nconst reset = () => {\n    g.transition().duration(50).call(\n        zoom.transform,\n        d3.zoomIdentity,\n      );\n};\nd3.select(\"#container\").append(\"rect\").attr(\"width\", width).attr(\"height\", height).attr(\"stroke\", \"grey\").attr(\"strokeWidth\", 2).attr(\"fill\", \"none\");\ng.append(\"path\")\n    .attr(\"class\", \"sphere\")\n    .attr(\"d\", pathGenerator({type: \"Sphere\"}))\n    .attr(\"fill\", colors.background)\n    .on(\"click\", reset);\n\naxios.all([axios.get(\"/data/static_viz_data/world_map/countries-110m.json\"), // topo info\n        axios.get(\"/data/static_viz_data/world_map/country.tsv\"), // database data\n        axios.get(\"/data/static_viz_data/world_map/small-countries.txt\"), // extreme small countries\n    ])\n  .then(axios.spread((topo, stat, small) => {\n    // process data\n    const temp = feature(topo.data, topo.data.objects.countries).features;\n    const countries = Object.keys(temp).map(k => temp[k]);\n    const data = d3.tsvParse(stat.data);\n    const validCountries = data.map(x => x.country);\n    const smallCountries = small.data.split(/\\r?\\n/)\n                .filter(e => validCountries.indexOf(e) >= 0)\n                .map(k => countries.find(x => x.properties.name === k));\n    const dict = {};\n    const numbers = [];\n    data.forEach(x => {\n        dict[x.country] = parseInt(x.number);\n        numbers.push(parseInt(x.number));\n    });\n\n    // visualization functions\n    const maxValue = max(numbers);\n    const myScale = d3.scaleLinear()\n            .domain([0, maxValue])\n            .range([0, 1]);\n    const getCountryFill = (d) => {\n        const name = d.properties.name;\n        if (dict[name]) return grad.get(myScale(dict[name]));\n        else return \"lightgrey\";\n    };\n    const showTooltip = (d) => {\n        div.transition()\n                .duration(200)\n                .style(\"opacity\", 1);\n        div.html(`<strong>Country: </strong><span class=\"details\">${d.properties.name }\n                <br></span><strong>Sample number: </strong><span class=\"details\">${dict[d.properties.name] || \"N/A\"}</span>`)\n            .style(\"left\", (d3.event.pageX + 15) + \"px\")\n            .style(\"top\", (d3.event.pageY + 15) + \"px\")\n            .style(\"padding\", \"5px\")\n            .style(\"border-radius\", \"3px\")\n            .style(\"color\", \"white\")\n            .style(\"background-color\", \"rgba(50,50,50, 0.85)\");\n    };\n    const moveTooltip = () => {\n        div.style(\"left\", (d3.event.pageX + 15) + \"px\")\n            .style(\"top\", (d3.event.pageY + 15) + \"px\");\n    };\n    const hideTooltip = () => {\n        div.transition()\n            .duration(500)\n            .style(\"opacity\", 0);\n    };\n    const highlightCountry = (sel) => {\n        d3.select(sel)\n            .style(\"opacity\", 1)\n            .style(\"stroke\", colors.activeStroke)\n            .style(\"stroke-width\", 2 / scaleFactor)\n            .raise();\n        d3.selectAll(\"text.fa\").raise();\n        g.transition()\n            .duration(100);\n    };\n    const resetHighlight = (sel) => {\n        d3.select(sel)\n            .transition()\n            .duration(100)\n            .style(\"opacity\", 0.9)\n            .style(\"stroke\", colors.background)\n            .style(\"stroke-width\", 1 / scaleFactor);\n    };\n\n    // draw legend\n    legendG.append(\"rect\")\n        .attr(\"fill\", \"white\")\n        .attr(\"width\", width)\n        .attr(\"height\", paddingB);\n    legendG.append(\"rect\")\n            .style(\"fill\", \"url(#gradient)\")\n            .attr(\"x\", 250)\n            .attr(\"y\", paddingB / 4)\n            .attr(\"width\", width - 500)\n            .attr(\"height\", paddingB / 5);\n    legendG.append(\"text\")\n        .text(\"0\")\n        .attr(\"text-anchor\", \"end\")\n        .attr(\"x\", 248)\n        .attr(\"y\", paddingB * 0.45 - 5);\n    legendG.append(\"text\")\n        .text(maxValue)\n        .attr(\"text-anchor\", \"start\")\n        .attr(\"x\", width - 248)\n        .attr(\"y\", paddingB * 0.45 - 5);\n\n    // draw country path\n    g.selectAll(\"path.country\").data(countries)\n        .enter()\n        .append(\"path\")\n        .attr(\"id\", d => d.properties.name)\n        .attr(\"class\", \"country\")\n        .attr(\"d\", pathGenerator)\n        .attr(\"fill\", getCountryFill)\n        .attr(\"opacity\", 0.9)\n        .attr(\"stroke\", colors.background)\n        .on(\"mouseover\", function (d) {\n            showTooltip(d);\n            highlightCountry(this);\n        })\n        .on(\"mousemove\", moveTooltip)\n        .on(\"mouseout\", function () {\n            hideTooltip();\n            resetHighlight(this);\n        });\n\n    // draw map labels for extreme small countries\n    g.selectAll(\"text.label\").data(smallCountries)\n        .enter().append(\"text\")\n        .attr(\"class\", \"fa label\")\n        .attr(\"id\", function (d) {\n            const path = pathGenerator(d);\n            const coord = path.split(\"L\")[0].substring(1).split(\",\").map(x => parseFloat(x));\n            d3.select(this).attr(\"x\", coord[0]).attr(\"y\", coord[1]);\n            return d.properties.name;\n        }).text(\"\\uf3c5\")\n        .attr(\"font-size\", \"18px\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"cursor\", \"default\")\n        .attr(\"fill\", getCountryFill)\n        .attr(\"stroke\", colors.iconStroke)\n        .on(\"mouseover\", function (d) {\n            showTooltip(d);\n            d3.select(this)\n                .style(\"stroke\", colors.activeStroke);\n            highlightCountry(`path#${d.properties.name}`);\n        })\n        .on(\"mousemove\", moveTooltip)\n        .on(\"mouseout\", function (d) {\n            hideTooltip();\n            d3.select(this)\n                .style(\"stroke\", colors.iconStroke);\n            resetHighlight(`path#${d.properties.name}`);\n        });\n\n    // draw unknown cases\n    if (!!dict[\"NULL\"]) {\n        otherG.append(\"text\").text(`Unknown: ${dict[\"NULL\"]}`)\n          .attr(\"x\", 0).attr(\"y\", 20);\n    }\n  }));\n\n// zoom interaction\nconst zoom = d3.zoom()\n    .extent([[0, 0], [width, height]])\n    .scaleExtent([1, 5])\n    .translateExtent([[0, 0], [width, height]])\n    .on(\"zoom\", () => {\n        scaleFactor =  d3.event.transform.k;\n        g.selectAll(\"text.fa\")\n            .attr(\"stroke-width\", `${1 / scaleFactor}px`)\n            .attr(\"font-size\", `${20 / scaleFactor}px`)\n            .attr(\"white-space\", function() {\n                if (scaleFactor > 4) {\n                    console.log(scaleFactor);\n                    d3.select(this).attr(\"opacity\", 0.3);\n                } else {\n                    d3.select(this).attr(\"opacity\", 1);\n                }\n            });\n        g.selectAll(\"path.country\")\n        .attr(\"stroke-width\",  `${1 / scaleFactor}px`);\n        g.attr(\"transform\", d3.event.transform);\n        const offsetX = scaleBarPos(d3.event.transform.k);\n        d3.select(\"#scaleAnchor\")\n          .transition()\n          .duration(100)\n          .attr(\"transform\", `translate(${offsetX}, 10)`);\n    });\n\nsvg.call(zoom);\n"]},"metadata":{},"sourceType":"module"}