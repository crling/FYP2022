{"ast":null,"code":"/// <reference types=\"ace\" />\nimport axios from \"axios\";\nimport * as $ from \"jquery\";\n\nfunction addRmBtnAction() {\n  $(\".btn-rm-opt\").each(function () {\n    var rmBtn = $(this);\n    var group = rmBtn.parents(\".input-group\");\n    rmBtn.off(\"click\").on(\"click\", function () {\n      group.remove();\n    });\n  });\n}\n\nfunction fixIndex() {\n  $(\".form-opt-container .input-group.fresh\").each(function () {\n    var optGroup = $(this);\n    var index = optGroup.index().toString();\n    optGroup.find(\"[name]\").each(function () {\n      var input = this;\n      input.name = input.name.replace(/_id_/g, index);\n    });\n    optGroup.removeClass(\"fresh\");\n  });\n}\n\nfunction axiosConfig() {\n  var multipart = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n  var config = {\n    headers: {\n      \"X-Requested-With\": \"XMLHttpRequest\",\n      \"X-CSRF-Token\": document.head.querySelector('meta[name=\"csrf-token\"]').content\n    }\n  };\n\n  if (multipart) {\n    config.headers[\"Content-Type\"] = \"'multipart/form-data'\";\n  }\n\n  return config;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  $(\".btn-add-opt\").each(function () {\n    var addBtn = $(this);\n    var container = addBtn.siblings(\".form-opt-container\")[0];\n    var template = addBtn.siblings(\"template\")[0];\n    addBtn.on(\"click\", function (e) {\n      container.appendChild(document.importNode(template.content, true));\n      addRmBtnAction();\n      fixIndex();\n    });\n  }); // sortable list\n\n  var lists = $(\".sortable-list\");\n\n  if (lists.length > 0) {\n    var sortable = require(\"sortablejs\");\n\n    lists.each(function () {\n      var list = $(this);\n      console.log(sortable);\n      sortable[\"default\"].create(this, {\n        handle: \".drag-handle\",\n        draggable: \".list-group-item\",\n        onEnd: function onEnd(e) {\n          var position = list.find(\"li\").map(function (i, e) {\n            return $(e).data(\"id\");\n          }).get().join(\",\");\n          axios.post(list.data(\"update-path\"), {\n            position: position\n          }, axiosConfig());\n        }\n      });\n    });\n  }\n\n  $(\"*[data-ace]\").each(function () {\n    console.log(\"test message\");\n    var input = $(this);\n    var form = input.parents(\"form\");\n    var mode = input.data(\"ace-mode\");\n    var id = input.attr(\"id\");\n    var name = input.attr(\"name\");\n    var editor = window.ace.edit(id);\n    var saveBtn = $(input.data(\"save-btn\"));\n    editor.setTheme(\"ace/theme/eclipse\");\n    editor.session.setMode(\"ace/mode/\" + mode);\n    editor.on(\"change\", function () {\n      if (!saveBtn[0]) return;\n      saveBtn.val(\"(Edited) Save\").removeClass(\"btn-secondary\").addClass(\"btn-warning\");\n    }); // check json\n\n    form.on(\"submit\", function (e) {\n      var value = editor.getValue();\n\n      if (mode === \"json\" && !isValidJson(value)) {\n        e.preventDefault();\n        window.alert(\"Please enter valid JSON.\");\n        window.setTimeout(function () {\n          form.find(\"input[type=submit]\").prop(\"disabled\", false);\n        }, 200);\n        return;\n      }\n\n      var hiddenInput = $(\"<input type='hidden' name='\".concat(name, \"'/>\"));\n      hiddenInput.appendTo(form);\n      hiddenInput.val(value);\n      saveBtn.val(\"Save\").removeClass(\"btn-warning\").addClass(\"btn-secondary\");\n    });\n  });\n});\n\nfunction isValidJson(json) {\n  try {\n    JSON.parse(json);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","map":{"version":3,"sources":["/Users/wangzhenyu/Desktop/fyp_workspace/meta_platform/app/javascript/packs/admin-form.ts"],"names":["axios","$","addRmBtnAction","each","rmBtn","group","parents","off","on","remove","fixIndex","optGroup","index","toString","find","input","name","replace","removeClass","axiosConfig","multipart","config","headers","document","head","querySelector","content","addEventListener","addBtn","container","siblings","template","e","appendChild","importNode","lists","length","sortable","require","list","console","log","create","handle","draggable","onEnd","position","map","i","data","get","join","post","form","mode","id","attr","editor","window","ace","edit","saveBtn","setTheme","session","setMode","val","addClass","value","getValue","isValidJson","preventDefault","alert","setTimeout","prop","hiddenInput","appendTo","json","JSON","parse"],"mappings":"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","sourcesContent":["/// <reference types=\"ace\" />\nimport axios from \"axios\";\nimport * as $ from \"jquery\";\n\ndeclare global {\n    interface Window {\n        ace: AceAjax.Ace;\n    }\n}\nfunction addRmBtnAction() {\n    $(\".btn-rm-opt\").each(function() {\n        const rmBtn = $(this);\n        const group = rmBtn.parents(\".input-group\");\n        rmBtn.off(\"click\").on(\"click\", () => {\n            group.remove();\n        });\n    });\n}\n\nfunction fixIndex() {\n    $(\".form-opt-container .input-group.fresh\").each(function() {\n        const optGroup = $(this);\n        const index = optGroup.index().toString();\n        optGroup.find(\"[name]\").each(function() {\n            const input = this as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement;\n            input.name = input.name.replace(/_id_/g, index);\n        });\n        optGroup.removeClass(\"fresh\");\n    });\n}\n\nfunction axiosConfig(multipart: boolean = false) {\n    const config = {\n        headers: {\n            \"X-Requested-With\": \"XMLHttpRequest\",\n            \"X-CSRF-Token\": document.head.querySelector<HTMLMetaElement>('meta[name=\"csrf-token\"]').content,\n        },\n    };\n    if (multipart) {\n        config.headers[\"Content-Type\"] = \"'multipart/form-data'\";\n    }\n    return config;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    $(\".btn-add-opt\").each(function() {\n        const addBtn = $(this);\n        const container = addBtn.siblings(\".form-opt-container\")[0];\n        const template = addBtn.siblings(\"template\")[0] as HTMLTemplateElement;\n        addBtn.on(\"click\", (e) => {\n            container.appendChild(document.importNode(template.content, true));\n            addRmBtnAction();\n            fixIndex();\n        });\n    });\n\n    // sortable list\n    const lists = $(\".sortable-list\");\n    if (lists.length > 0) {\n        const sortable = require(\"sortablejs\");\n        lists.each(function() {\n            const list = $(this);\n            console.log(sortable);\n            sortable.default.create(this, {\n                handle: \".drag-handle\",\n                draggable: \".list-group-item\",\n                onEnd: (e) => {\n                    const position = list.find(\"li\").map((i, e) => $(e).data(\"id\")).get().join(\",\");\n                    axios.post(list.data(\"update-path\"), { position}, axiosConfig());\n                },\n            });\n        });\n    }\n\n    $(\"*[data-ace]\").each(function() {\n        console.log(\"test message\");\n        const input = $(this);\n        const form = input.parents(\"form\");\n        const mode = input.data(\"ace-mode\");\n        const id = input.attr(\"id\");\n        const name = input.attr(\"name\");\n        const editor = window.ace.edit(id);\n        const saveBtn = $(input.data(\"save-btn\"));\n        editor.setTheme(\"ace/theme/eclipse\");\n        editor.session.setMode(\"ace/mode/\" + mode);\n        editor.on(\"change\", () => {\n            if (!saveBtn[0]) return;\n            saveBtn.val(\"(Edited) Save\")\n                .removeClass(\"btn-secondary\")\n                .addClass(\"btn-warning\");\n        });\n        // check json\n        form.on(\"submit\", (e) => {\n            const value = editor.getValue();\n            if (mode === \"json\" && !isValidJson(value)) {\n                e.preventDefault();\n                window.alert(\"Please enter valid JSON.\");\n                window.setTimeout(() => {\n                    form.find(\"input[type=submit]\").prop(\"disabled\", false);\n                }, 200);\n                return;\n            }\n            const hiddenInput = $(`<input type='hidden' name='${name}'/>`);\n            hiddenInput.appendTo(form);\n            hiddenInput.val(value);\n            saveBtn.val(\"Save\")\n                .removeClass(\"btn-warning\")\n                .addClass(\"btn-secondary\");\n        });\n    });\n});\n\nfunction isValidJson(json) {\n    try {\n        JSON.parse(json);\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n"]},"metadata":{},"sourceType":"module"}