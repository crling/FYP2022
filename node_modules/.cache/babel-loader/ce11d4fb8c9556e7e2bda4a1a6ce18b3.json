{"ast":null,"code":"import Oviz from \"crux\";\nimport template from \"./template.bvt\";\nvar categoryIndex = 0;\nvar valueIndex = 1;\nvar Color = Oviz.color.Color;\nexport function init(id, path, config) {\n  var title = config[\"title\"];\n  Oviz.visualize({\n    el: id,\n    template: template,\n    data: {\n      title: title\n    },\n    loadData: {\n      pieData: {\n        url: path,\n        type: \"tsv\",\n        dsvHasHeader: true,\n        loaded: function loaded(data) {\n          var pieData = [];\n          var legendData = [];\n          var sum = 0;\n          data.forEach(function (d) {\n            sum += parseFloat(Object.values(d)[valueIndex]);\n          });\n          data.forEach(function (d, i) {\n            var num = parseFloat(Object.values(d)[valueIndex]);\n            var p = parseFloat(Object.values(d)[valueIndex]) / sum;\n            var name = \"\".concat(Object.values(d)[categoryIndex], \" - \").concat((p * 100).toFixed(2), \"%\");\n            var c = Color.hsl(i % 6 * 60, 60 + Math.floor(i / 6) * 10, 60 + Math.floor(i / 6) * 10);\n            pieData.push({\n              color: c,\n              num: num,\n              value: p,\n              name: name\n            });\n            legendData.push({\n              fill: c.string,\n              label: name\n            });\n          });\n          this.data.legendData = legendData;\n          return pieData;\n        }\n      }\n    }\n  });\n}","map":{"version":3,"sources":["/Users/wangzhenyu/Desktop/fyp_workspace/meta_platform/app/javascript/viz/static_donghnut/index.ts"],"names":["Oviz","template","categoryIndex","valueIndex","Color","color","init","id","path","config","title","visualize","el","data","loadData","pieData","url","type","dsvHasHeader","loaded","legendData","sum","forEach","d","parseFloat","Object","values","i","num","p","name","toFixed","c","hsl","Math","floor","push","value","fill","string","label"],"mappings":"AACA,OAAOA,IAAP,MAAiB,MAAjB;AACA,OAAOC,QAAP,MAAqB,gBAArB;AAEA,IAAMC,aAAa,GAAG,CAAtB;AACA,IAAMC,UAAU,GAAG,CAAnB;AACA,IAAMC,KAAK,GAAGJ,IAAI,CAACK,KAAL,CAAWD,KAAzB;AAEA,OAAO,SAASE,IAAT,CAAcC,EAAd,EAAkBC,IAAlB,EAAwBC,MAAxB,EAAgC;AACnC,MAAMC,KAAK,GAAGD,MAAM,CAAC,OAAD,CAApB;AACAT,EAAAA,IAAI,CAACW,SAAL,CAAe;AACXC,IAAAA,EAAE,EAAEL,EADO;AAEXN,IAAAA,QAAQ,EAARA,QAFW;AAGXY,IAAAA,IAAI,EAAE;AAACH,MAAAA,KAAK,EAALA;AAAD,KAHK;AAIXI,IAAAA,QAAQ,EAAE;AACNC,MAAAA,OAAO,EAAE;AACLC,QAAAA,GAAG,EAAER,IADA;AAELS,QAAAA,IAAI,EAAE,KAFD;AAGLC,QAAAA,YAAY,EAAE,IAHT;AAILC,QAAAA,MAJK,kBAIEN,IAJF,EAIQ;AACT,cAAME,OAAO,GAAG,EAAhB;AACA,cAAMK,UAAU,GAAG,EAAnB;AACA,cAAIC,GAAG,GAAG,CAAV;AACAR,UAAAA,IAAI,CAACS,OAAL,CAAa,UAAAC,CAAC,EAAI;AACdF,YAAAA,GAAG,IAAIG,UAAU,CAACC,MAAM,CAACC,MAAP,CAAcH,CAAd,EAAiBpB,UAAjB,CAAD,CAAjB;AACH,WAFD;AAGAU,UAAAA,IAAI,CAACS,OAAL,CAAa,UAACC,CAAD,EAAII,CAAJ,EAAU;AACnB,gBAAMC,GAAG,GAAGJ,UAAU,CAACC,MAAM,CAACC,MAAP,CAAcH,CAAd,EAAiBpB,UAAjB,CAAD,CAAtB;AACA,gBAAM0B,CAAC,GAAGL,UAAU,CAACC,MAAM,CAACC,MAAP,CAAcH,CAAd,EAAiBpB,UAAjB,CAAD,CAAV,GAA2CkB,GAArD;AACA,gBAAMS,IAAI,aAAML,MAAM,CAACC,MAAP,CAAcH,CAAd,EAAiBrB,aAAjB,CAAN,gBAA2C,CAAC2B,CAAC,GAAG,GAAL,EAAUE,OAAV,CAAkB,CAAlB,CAA3C,MAAV;AACA,gBAAMC,CAAC,GAAG5B,KAAK,CAAC6B,GAAN,CAAWN,CAAC,GAAC,CAAH,GAAM,EAAhB,EAAoB,KAAGO,IAAI,CAACC,KAAL,CAAYR,CAAC,GAAC,CAAd,IAAkB,EAAzC,EAA6C,KAAGO,IAAI,CAACC,KAAL,CAAYR,CAAC,GAAC,CAAd,IAAkB,EAAlE,CAAV;AACAZ,YAAAA,OAAO,CAACqB,IAAR,CAAa;AAAC/B,cAAAA,KAAK,EAAE2B,CAAR;AAAWJ,cAAAA,GAAG,EAAEA,GAAhB;AAAqBS,cAAAA,KAAK,EAAER,CAA5B;AAA+BC,cAAAA,IAAI,EAAEA;AAArC,aAAb;AACAV,YAAAA,UAAU,CAACgB,IAAX,CAAgB;AAACE,cAAAA,IAAI,EAACN,CAAC,CAACO,MAAR;AAAgBC,cAAAA,KAAK,EAACV;AAAtB,aAAhB;AACH,WAPD;AAQA,eAAKjB,IAAL,CAAUO,UAAV,GAAuBA,UAAvB;AACA,iBAAOL,OAAP;AACH;AArBI;AADH;AAJC,GAAf;AA8BH","sourcesContent":["\nimport Oviz from \"crux\"\nimport template from \"./template.bvt\"\n\nconst categoryIndex = 0;\nconst valueIndex = 1;\nconst Color = Oviz.color.Color;\n\nexport function init(id, path, config) {\n    const title = config[\"title\"];\n    Oviz.visualize({\n        el: id,\n        template,\n        data: {title},\n        loadData: {\n            pieData: {\n                url: path,\n                type: \"tsv\",\n                dsvHasHeader: true,\n                loaded(data) {\n                    const pieData = [];\n                    const legendData = [];\n                    let sum = 0;\n                    data.forEach(d => {\n                        sum += parseFloat(Object.values(d)[valueIndex]);\n                    });\n                    data.forEach((d, i) => {\n                        const num = parseFloat(Object.values(d)[valueIndex]);\n                        const p = parseFloat(Object.values(d)[valueIndex]) / sum;\n                        const name = `${Object.values(d)[categoryIndex]} - ${(p * 100).toFixed(2)}%`;\n                        const c = Color.hsl((i%6)*60, 60+Math.floor((i/6))*10, 60+Math.floor((i/6))*10) ;\n                        pieData.push({color: c, num: num, value: p, name: name});\n                        legendData.push({fill:c.string, label:name});\n                    });\n                    this.data.legendData = legendData;\n                    return pieData;\n                },\n            },\n        },\n    });\n}\n"]},"metadata":{},"sourceType":"module"}